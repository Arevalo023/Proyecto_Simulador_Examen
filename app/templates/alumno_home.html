{% extends "base.html" %}
{% block content %}

<div class="card">
    <h2 class="card-title">Bienvenido</h2>
    <p class="card-desc">
        Hola {{ nombre }}
    </p>

    <p class="card-desc">
        Desde aquí puedes iniciar el simulador de práctica (20 preguntas, 1 min c/u)
        y el examen final (40 preguntas).
    </p>

    <div class="card-desc" style="font-size:0.8rem; color:#cbd5e1;">
        Intentos práctica restantes: {{ restantes_practica }} / 6<br>
        Intentos final restantes: {{ restantes_final }} / 3
    </div>

    <div class="actions-row" style="margin-top:16px;">
        {% if restantes_practica > 0 %}
            <a class="btn-primary full-width" href="{{ url_for('exam.start_practica') }}">
                Iniciar práctica
            </a>
        {% else %}
            <button class="btn-primary full-width" disabled
                    style="opacity:0.4; cursor:not-allowed;">
                Sin intentos de práctica
            </button>
        {% endif %}

        {% if restantes_final > 0 %}
            <a class="btn-secondary full-width" href="{{ url_for('exam.start_final') }}">
                Iniciar examen final
            </a>
        {% else %}
            <button class="btn-secondary full-width" disabled
                    style="opacity:0.4; cursor:not-allowed;">
                Sin intentos final
            </button>
        {% endif %}
    </div>
</div>

<div class="card">
    <h2 class="card-title">Historial práctica</h2>
    {% if historial_practica and historial_practica|length > 0 %}
        {% for intento in historial_practica %}
            <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid rgba(148,163,184,0.2);">
                <p class="card-desc" style="font-size:0.8rem; margin-bottom:6px;">
                    {{ intento.fecha_hora_realiza }} —
                    {{ "%.2f"|format(intento.calificacion) }}%
                    {% if intento.aprobado %}
                        (Aprobado)
                    {% else %}
                        (No aprobado)
                    {% endif %}
                </p>
                <a class="btn-secondary full-width"
                   href="{{ url_for('exam.review_attempt', id_intento=intento.id_intento) }}">
                    Ver detalles
                </a>
            </div>
        {% endfor %}
    {% else %}
        <p class="card-desc" style="font-size:0.8rem; color:#64748b;">
            Aún no has iniciado prácticas.
        </p>
    {% endif %}
</div>

<div class="card">
    <h2 class="card-title">Historial examen final</h2>
    {% if historial_final and historial_final|length > 0 %}
        {% for intento in historial_final %}
            <div style="margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid rgba(148,163,184,0.2);">
                <p class="card-desc" style="font-size:0.8rem; margin-bottom:6px;">
                    {{ intento.fecha_hora_realiza }} —
                    {{ "%.2f"|format(intento.calificacion) }}%
                    {% if intento.aprobado %}
                        (Aprobado)
                    {% else %}
                        (No aprobado)
                    {% endif %}
                </p>
                <a class="btn-secondary full-width"
                   href="{{ url_for('exam.review_attempt', id_intento=intento.id_intento) }}">
                    Ver detalles
                </a>
            </div>
        {% endfor %}
    {% else %}
        <p class="card-desc" style="font-size:0.8rem; color:#64748b;">
            Aún no has hecho examen final.
        </p>
    {% endif %}
</div>

{% endblock %}
